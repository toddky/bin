#!/usr/bin/env bash
declare -r CURRENT_DIR="$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")"
declare -r preview="$CURRENT_DIR/fzf-preview"

# Uncomment to debug
#verbosity=1

# Get config
config=${1-default}
shift
if ((verbosity)); then
	echo "CONFIG: '$config'"
fi

# Default args
declare -A args
args['multi']="--multi"
args['height']='--height 40%'
args['tiebreak']='--tiebreak=length'
args['reverse']='--reverse'
args['keybind']='--bind=ctrl-s:toggle-sort'
args['query']="--query='$@ '"

# Custom colorscheme
args['color']='--color '
args['color']+='fg:33,bg:233,fg+:39,bg+:236'
args['color']+=',hl:172,hl+:172'
args['color']+=',spinner:166,pointer:166,gutter:236,marker:214'
args['color']+=',prompt:123,info:123'
args['color']+=',border:33,preview-fg:159,preview-bg:235'

# TODO: Set config
	#--preview-window bottom:50% \
	#--preview "'my-fzf-preview-dir {}'" \
	#--exact
	#--tiebreak=index \
	#--preview-window down:80% \
	#--preview "'my-fzf-preview-file {}'" \
	#--preview "'my-fzf-preview-git-diff {}'" \
	#--preview "'git show --color=always --numstat {1}'" \
	#--expect=ctrl-t,ctrl-v

# TODO: Preview for things that aren't files
args['preview']+="--preview '$preview/file {}' --preview-window right:50%"

# Combine options
cmd='fzf'
for name in "${!args[@]}"; do
	((verbosity)) && printf "ARG %-8s : %s\n" "$name" "${args[$name]}"
	cmd+=" ${args[$name]}"
done

# Print and run
((verbosity)) && echo "COMMAND: $cmd"
eval exec $cmd

